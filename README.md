# Chinese Anki Deck Generators

Этот проект включает два Python-скрипта для создания Anki-колод, упрощающих изучение китайского языка:

1. **Hanzi Movie Method Deck Generator** (`anki_hanzi_movie_method_rus.py`): Создаёт карточки для отдельных китайских иероглифов с мнемоническими историями по методу Hanzi Movie Method, вдохновлённому [Mandarin Blueprint](https://www.mandarinblueprint.com/). Использует OpenAI API для генерации историй и Forvo API для аудио.
2. **Words and Phrases Deck Generator** (`anki_hanyu.py`): Создаёт карточки для китайских фраз и словосочетаний с примерами предложений из базы [Tatoeba](https://tatoeba.org/). Использует Forvo API для аудио, без OpenAI API.

Оба скрипта поддерживают упрощённые иероглифы, цветной пиньинь, порядок черт и вывод на русском языке. Они подходят для разных подходов: мнемонического запоминания иероглифов или изучения фраз в контексте.

## Особенности

### Hanzi Movie Method Deck Generator

- **Мнемонические истории**: Генерирует яркие, абсурдные истории для отдельных иероглифов по методу Hanzi Movie Method ([Mandarin Blueprint](https://www.mandarinblueprint.com/)), связывая иероглиф, его значение, компоненты, актера и мнемоническое пространство.
- **Поля карточек**:
  - Иероглиф: Отдельный иероглиф (например, 你).
  - Пиньинь: Транскрипция (например, nǐ).
  - Цветной пиньинь: Пиньинь с цветными тонами (HTML-форматирование).
  - Значение: Перевод на русский (например, ты).
  - Пространство: Мнемоническое место с актёром (например, (Николай Басков) Энциклопедическая библиотека-дом - Архивный вход).
  - Подсказка: Компоненты иероглифа (например, 人 (человек), 尔 (ты, второй)).
  - Аудио: Произношение через Forvo API (опционально).
  - История: Мнемоническая история.
  - Порядок черт: SVG-изображение порядка черт (из папок `svgs` или `svgs-still`).
- **Типы карточек**:
  - Узнавание: Показывает порядок черт → все поля.
  - Вспоминание: Показывает значение + пространство → иероглиф + остальные поля.
- **Источник данных**:
  - Истории: OpenAI API (`gpt-4o-mini`).
  - Компоненты: Локальная база `hanzi_db.txt` или встроенный словарь.
  - Аудио: Forvo API.
  - Порядок черт: SVG-файлы.
- **Выходной файл**: `vova_hanzi_spaces_actors_rus.apkg`.

### Words and Phrases Deck Generator

- **Примеры фраз**: Извлекает примеры китайских фраз (словосочетаний или предложений) из [Tatoeba](https://tatoeba.org/) с переводом на английский (переводится на русский через Google Translate).
- **Поля карточек**:
  - Chinese: Фраза или слово (например, 你好).
  - Pinyin: Транскрипция (например, nǐ hǎo).
  - ColoredPinyin: Пиньинь с цветными тонами.
  - Meaning: Значение фразы (например, Привет).
  - Example: Пример предложения (например, 你好吗？).
  - ExamplePinyin: Пиньинь примера (например, nǐ hǎo ma?).
  - ExampleMeaning: Перевод примера (например, Как дела?).
  - Audio: Произношение фразы (Forvo API, опционально).
  - StrokeOrder: Порядок черт для иероглифов фразы (SVG).
- **Типы карточек**:
  - Recognition: Показывает порядок черт → все поля.
  - Production: Показывает значение → фраза + остальные поля.
- **Источник данных**:
  - Значение: Google Translate или встроенный словарь.
  - Примеры: Tatoeba API.
  - Аудио: Forvo API.
  - Порядок черт: SVG-файлы.
- **Выходной файл**: `vova_chinese.apkg`.

### Пример

[Пример карточки Anki mobile](Anki mobile example with HMM.png)

### Общие особенности

- **Аудио**: Forvo API для произношения (опционально).
- **Порядок черт**: SVG-изображения из папок `svgs` или `svgs-still` для визуализации порядка написания.
- **Пиньинь**: Цветное форматирование тонов (1-й: синий, 2-й: зелёный, 3-й: пурпурный, 4-й: красный, 5-й: серый).
- **Архивация**: Входные файлы сохраняются в архив после обработки.
- **Дедупликация**: Удаляет дубликаты иероглифов/фраз, проверяя архивные папки.
- **Русский язык**: Значения, истории, переводы примеров на русском.

## Требования

- **Python**: 3.8+
- **Общие библиотеки**:
  - `genanki`
  - `pypinyin`
  - `hanziconv`
  - `requests`
  - `python-dotenv`
  - `googletrans==4.0.0-rc1`
- **Для Hanzi Movie Method**:
  - `openai`
- **Ключи API**:
  - **OpenAI API**: Обязателен для `hanzi_movie_method.py`.
  - **Forvo API**: Опционален для обоих скриптов.
- **Файлы**:
  - `hanzi_db.txt`: Локальная база компонентов для `hanzi_movie_method.py` (опционально).
  - `graphics.txt`: Данные для порядка черт (опционально).
  - Папки `svgs` и `svgs-still`: SVG-файлы порядка черт.
- **Входные файлы**:
  - Для `hanzi_movie_method.py`: `chinese_words_hanzi_movie_method.txt` (отдельные иероглифы).
  - Для `tatoeba_examples.py`: `chinese_words.txt` (фразы или слова).

## Установка

1. **Склонируйте репозиторий или скачайте скрипты**:

   git clone https://github.com/hikarikumo/anki_hanyu_decks_generation
   cd anki_hanyu_decks_generation

    Создайте файл .venv в корне проекта:

    python3 -m venv .venv

    Установите зависимости:

    pip install -r requirements.txt

    pip install genanki pypinyin hanziconv requests python-dotenv googletrans>=4.0.0-rc1

    Для hanzi_movie_method.py дополнительно:

    pip install openai

    Настройте ключи API:

    OPENAI_API_KEY=ваш_ключ_от_openai  # Только для hanzi_movie_method.py
    FORVO_API_KEY=ваш_ключ_от_forvo   # Опционально для обоих

    Получите ключи:
      - [OpenAI](https://platform.openai.com/)
      - [Forvo](https://api.forvo.com/login/)

    Создайте входные файлы:

    Для hanzi_movie_method.py: Создайте chinese_words_hanzi_movie_method.txt с отдельными иероглифами (по одному на строку):
    text

        你
        好
        我
        爱
        家

2. **Использование Hanzi Movie Method Deck Generator**:

    Запустите скрипт:

    python hanzi_movie_method.py

    Что произойдёт:

        Читает иероглифы из chinese_words_hanzi_movie_method.txt.
        Удаляет дубликаты, проверяя архив в input_words_hmm_archive.
        Для каждого иероглифа:
            Получает пиньинь и цветной пиньинь.
            Извлекает значение и компоненты (hanzi_db.txt или словарь).
            Генерирует мнемоническое пространство и выбирает актера.
            Загружает аудио (Forvo API, если настроен).
            Генерирует историю через OpenAI API в стиле Hanzi Movie Method.
            Добавляет SVG для порядка черт.
        Создаёт колоду vova_hanzi_spaces_actors_rus.apkg.
        Архивирует входной файл в input_words_hmm_archive.
        Выводит результаты в консоль.

    Пример вывода:
    text

        Обработанные иероглифы:
        你 (nǐ): ты, (Николай Басков) Энциклопедическая библиотека-дом - Архивный вход
        Подсказка: 人 (человек), 尔 (ты, второй)
        История: В Энциклопедической библиотеке Николай Басков видит 人, поющего его хиты! ...
        ...
        Создана колода Anki: vova_hanzi_spaces_actors_rus.apkg
        Archived input file: input_words_hmm_archive/chinese_words_2025-04-12_12_00_00.txt

    Words and Phrases Deck Generator

        Запустите скрипт:

    python3 anki_hanyu.py

    Что произойдёт:

        Читает фразы из chinese_words.txt.
        Удаляет дубликаты, проверяя архив в input_words_archive.
        Для каждой фразы:
            Получает пиньинь и цветной пиньинь.
            Извлекает значение (Google Translate или словарь).
            Загружает пример предложения из Tatoeba API.
            Загружает аудио (Forvo API, если настроен).
            Добавляет SVG для порядка черт иероглифов фразы.
        Создаёт колоду vova_chinese_hsk1.apkg.
        Архивирует входной файл в input_words_archive.
        Выводит результаты в консоль.

    Пример вывода:
    text

        Processed words:
        你好 (nǐ hǎo): Привет
        谢谢 (xiè xiè): Спасибо
        ...
        Created Anki deck: vova_chinese_hsk1.apkg
        Archived input file: input_words_archive/chinese_words_2025-04-12_12_00_00.txt
        Импортируйте колоду в Anki:
            Откройте Anki.
            Выберите Файл -> Импорт.
            Укажите .apkg файл (vova_hanzi_spaces_actors_rus.apkg или vova_chinese_hsk1.apkg).
            Начните изучение!

3. **Настройка API**

    - OpenAI API (только для hanzi_movie_method.py):
        - Модель: gpt-4o-mini (можно заменить на gpt-4o или gpt-3.5-turbo в переменной OPENAI_MODEL).
        - Токены: OPENAI_MAX_TOKENS=300 для полных историй.
        - Температура: OPENAI_TEMPERATURE=0.8 для баланса креативности и структуры.
    - Forvo API (для обоих скриптов):
        - Требуется ключ для загрузки аудио.
        - Без ключа аудио не добавляется, но скрипты продолжают работать.

4. **Проблемы и решения**

    - Истории обрываются (Hanzi Movie Method):
        Увеличьте OPENAI_MAX_TOKENS в hanzi_movie_method.py.
        Проверьте, что OPENAI_API_KEY действителен и лимиты не превышены.
    - Нет аудио:
        Убедитесь, что FORVO_API_KEY указан в .env.
        Проверьте интернет-соединение или лимиты Forvo API.
    - Примеры отсутствуют (Words and Phrases):
        Tatoeba может не содержать примеров для некоторых фраз. Поле останется пустым.
        Проверьте интернет-соединение.
    - Порядок черт не отображается:
        Убедитесь, что папки svgs и svgs-still содержат SVG-файлы (например, 20320.svg для 你).
        Проверьте наличие graphics.txt.
    - Ошибки перевода (Words and Phrases):
        Google Translate может быть нестабильным. Используйте hanzi_db.txt или другой словарь для значений.
    - Дубликаты не удаляются:
        Проверьте папки input_words_hmm_archive или input_words_archive на наличие старых файлов.

5. **Благодарности**

Особая благодарность следующим проектам за их вклад в этот проект:

- [MakeMeAHanzi](https://github.com/skishore/makemeahanzi/) за предоставление данных и SVG-файлов для порядка черт иероглифов, которые значительно упрощают визуальное изучение китайского языка.
- [genanki](https://github.com/kerrickstaley/genanki/) за мощную библиотеку для создания Anki-колод, которая сделала возможной генерацию карточек в этом проекте.
- [Mandarin Blueprint](https://www.mandarinblueprint.com/category/hanzi-movie-method-series/) За подробное описание мнемонического метода запоминания китайских иероглифов

6. **Лицензия**

MIT License. Используйте, модифицируйте и распространяйте свободно.

Создано для эффективного и увлекательного изучения китайского языка!
